<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Data frames – Introduction to R (ResBaz Victoria 2024)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./plotting.html" rel="next">
<link href="./starting.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./data_frames.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data frames</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to R (ResBaz Victoria 2024)</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./starting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Starting out in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_frames.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data frames</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./plotting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plotting with ggplot2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summarizing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Summarizing data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./thinking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Thinking in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./next_steps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Next steps</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setting-up" id="toc-setting-up" class="nav-link active" data-scroll-target="#setting-up"><span class="header-section-number">2.1</span> Setting up</a></li>
  <li><a href="#loading-data" id="toc-loading-data" class="nav-link" data-scroll-target="#loading-data"><span class="header-section-number">2.2</span> Loading data</a></li>
  <li><a href="#exploring" id="toc-exploring" class="nav-link" data-scroll-target="#exploring"><span class="header-section-number">2.3</span> Exploring</a></li>
  <li><a href="#indexing-data-frames" id="toc-indexing-data-frames" class="nav-link" data-scroll-target="#indexing-data-frames"><span class="header-section-number">2.4</span> Indexing data frames</a></li>
  <li><a href="#columns-are-vectors" id="toc-columns-are-vectors" class="nav-link" data-scroll-target="#columns-are-vectors"><span class="header-section-number">2.5</span> Columns are vectors</a>
  <ul class="collapse">
  <li><a href="#quiz-reading-r-code" id="toc-quiz-reading-r-code" class="nav-link" data-scroll-target="#quiz-reading-r-code">Quiz: reading R code</a></li>
  </ul></li>
  <li><a href="#logical-indexing" id="toc-logical-indexing" class="nav-link" data-scroll-target="#logical-indexing"><span class="header-section-number">2.6</span> Logical indexing</a>
  <ul class="collapse">
  <li><a href="#challenge-logical-indexing" id="toc-challenge-logical-indexing" class="nav-link" data-scroll-target="#challenge-logical-indexing">Challenge: logical indexing</a></li>
  <li><a href="#a-dplyr-shorthand" id="toc-a-dplyr-shorthand" class="nav-link" data-scroll-target="#a-dplyr-shorthand"><span class="header-section-number">2.6.1</span> A <code>dplyr</code> shorthand</a></li>
  </ul></li>
  <li><a href="#factors" id="toc-factors" class="nav-link" data-scroll-target="#factors"><span class="header-section-number">2.7</span> Factors</a></li>
  <li><a href="#readability-vs-tidyness" id="toc-readability-vs-tidyness" class="nav-link" data-scroll-target="#readability-vs-tidyness"><span class="header-section-number">2.8</span> Readability vs tidyness</a></li>
  <li><a href="#sorting" id="toc-sorting" class="nav-link" data-scroll-target="#sorting"><span class="header-section-number">2.9</span> Sorting</a></li>
  <li><a href="#joining-data-frames" id="toc-joining-data-frames" class="nav-link" data-scroll-target="#joining-data-frames"><span class="header-section-number">2.10</span> Joining data frames</a>
  <ul class="collapse">
  <li><a href="#quiz" id="toc-quiz" class="nav-link" data-scroll-target="#quiz">Quiz</a></li>
  </ul></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">2.11</span> Further reading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data frames</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><em>Data frame</em> is R’s name for tabular data. We generally want each row in a data frame to represent a unit of observation, and each column to contain a different type of information about the units of observation. Tabular data in this form is called <a href="http://vita.had.co.nz/papers/tidy-data.html">“tidy data”</a>.</p>
<p>Today we will be using a collection of modern packages collectively known as the <a href="https://www.tidyverse.org/">Tidyverse</a>. R and its predecessor S have a history dating back to 1976. The Tidyverse fixes some dubious design decisions baked into “base R”, including having its own slightly improved form of data frame, which is called a <em>tibble</em>. Sticking to the Tidyverse where possible is generally safer, Tidyverse packages are more willing to generate errors rather than ignore problems.</p>
<section id="setting-up" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="setting-up"><span class="header-section-number">2.1</span> Setting up</h2>
<p>Our first step is to download the files we need and to install the Tidyverse. This is the one step where we ask you to copy and paste some code:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download files for this workshop</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://monashbioinformaticsplatform.github.io/r-intro-resbazvic2024/r-intro.zip"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">destfile=</span><span class="st">"r-intro.zip"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">"r-intro.zip"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Tidyverse</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you run into problems installing all of the <code>tidyverse</code> you may have more success installing individual packages:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"dplyr"</span>,<span class="st">"readr"</span>,<span class="st">"tidyr"</span>,<span class="st">"ggplot2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We need to load the <code>tidyverse</code> package in order to use it.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># OR</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>tidyverse</code> package loads various other packages, setting up a modern R environment. In this section we will be using functions from the <code>dplyr</code>, <code>readr</code> and <code>tidyr</code> packages.</p>
<p>R is a language with mini-languages within it that solve specific problem domains. <code>dplyr</code> is such a mini-language, a set of “verbs” (functions) that work well together. <code>dplyr</code>, with the help of <code>tidyr</code> for some more complex operations, provides a way to perform most manipulations on a data frame that you might need.</p>
</section>
<section id="loading-data" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="loading-data"><span class="header-section-number">2.2</span> Loading data</h2>
<p>We will use the <code>read_csv</code> function from <code>readr</code> to load a data set. (See also <code>read.csv</code> in base R.) CSV stands for Comma Separated Values, and is a text format used to store tabular data. The first few lines of the file we are loading are shown below. Conventionally the first line contains column headings.</p>
<pre><code>name,region,oecd,g77,lat,long,income2017
Afghanistan,asia,FALSE,TRUE,33,66,low
Albania,europe,FALSE,FALSE,41,20,upper_mid
Algeria,africa,FALSE,TRUE,28,3,upper_mid
Andorra,europe,FALSE,FALSE,42.50779,1.52109,high
Angola,africa,FALSE,TRUE,-12.5,18.5,lower_mid</code></pre>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>geo <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"r-intro/geo.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 196 Columns: 7
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): name, region, income2017
dbl (2): lat, long
lgl (2): oecd, g77

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>geo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 196 × 7
   name             region oecd  g77      lat  long income2017
   &lt;chr&gt;            &lt;chr&gt;  &lt;lgl&gt; &lt;lgl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     
 1 Australia        asia   TRUE  FALSE -25     135  high      
 2 Brunei           asia   FALSE TRUE    4.5   115. high      
 3 Cambodia         asia   FALSE TRUE   13     105  lower_mid 
 4 China            asia   FALSE TRUE   35     105  upper_mid 
 5 Fiji             asia   FALSE TRUE  -18     178  upper_mid 
 6 Hong Kong, China asia   FALSE FALSE  22.3   114. high      
 7 Indonesia        asia   FALSE TRUE   -5     120  lower_mid 
 8 Japan            asia   TRUE  FALSE  35.7   140. high      
 9 Kiribati         asia   FALSE FALSE   1.42  173. lower_mid 
10 North Korea      asia   FALSE TRUE   40     127  low       
# ℹ 186 more rows</code></pre>
</div>
</div>
<p><code>read_csv</code> has guessed the type of data each column holds:</p>
<ul>
<li><code>&lt;chr&gt;</code> - character strings</li>
<li><code>&lt;dbl&gt;</code> - numerical values. Technically these are “doubles”, which is a way of storing numbers with 15 digits precision.</li>
<li><code>&lt;lgl&gt;</code> - logical values, <code>TRUE</code> or <code>FALSE</code>.</li>
</ul>
<p>We will also encounter:</p>
<ul>
<li><code>&lt;int&gt;</code> - integers, a fancy name for whole numbers.</li>
<li><code>&lt;fct&gt;</code> - factors, categorical data. We will get to this shortly.</li>
</ul>
<p>You can also see this data frame referring to itself as “a tibble”. This is the Tidyverse’s improved form of data frame. Tibbles present themselves more conveniently than base R data frames. Base R data frames don’t show the type of each column, and output every row when you try to view them.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>A data frame can also be created from vectors, with the <code>tibble</code> function. (See also <code>data.frame</code> in base R.) For example:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">foo=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>), <span class="at">bar=</span><span class="fu">c</span>(<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
    foo bar  
  &lt;dbl&gt; &lt;chr&gt;
1    10 a    
2    20 b    
3    30 c    </code></pre>
</div>
</div>
<p>The argument names become column names in the data frame.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <em>path</em> to the file on our server is <code>"r-intro/geo.csv"</code>. This says, starting from your working directory, look in the directory <code>r-intro</code> for the file <code>geo.csv</code>. The steps in the path are separated by <code>/</code>. Your working directory is shown at the top of the console pane. The path needed might be different on your own computer, depending where you downloaded the file.</p>
<p>One way to work out the correct path is to find the file in the file browser pane, click on it and select “Import Dataset…”.</p>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="figures/import.png" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="exploring" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="exploring"><span class="header-section-number">2.3</span> Exploring</h2>
<p>The <code>View</code> function gives us a spreadsheet-like view of the data frame.</p>
<pre><code>View(geo)</code></pre>
<p><code>print</code> with the <code>n</code> argument can be used to show more than the first 10 rows on the console.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(geo, <span class="at">n=</span><span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can extract details of the data frame with further functions:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(geo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 196</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(geo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(geo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "name"       "region"     "oecd"       "g77"        "lat"       
[6] "long"       "income2017"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(geo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name              region             oecd            g77         
 Length:196         Length:196         Mode :logical   Mode :logical  
 Class :character   Class :character   FALSE:165       FALSE:65       
 Mode  :character   Mode  :character   TRUE :31        TRUE :131      
                                                                      
                                                                      
                                                                      
      lat              long           income2017       
 Min.   :-42.00   Min.   :-175.000   Length:196        
 1st Qu.:  4.00   1st Qu.:  -5.625   Class :character  
 Median : 17.42   Median :  21.875   Mode  :character  
 Mean   : 19.03   Mean   :  23.004                     
 3rd Qu.: 39.82   3rd Qu.:  51.892                     
 Max.   : 65.00   Max.   : 179.145                     </code></pre>
</div>
</div>
</section>
<section id="indexing-data-frames" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="indexing-data-frames"><span class="header-section-number">2.4</span> Indexing data frames</h2>
<p>Data frames can be subset using <code>[row,column]</code> syntax.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>geo[<span class="dv">4</span>,<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  region
  &lt;chr&gt; 
1 asia  </code></pre>
</div>
</div>
<p>Note that while this is a single value, it is still wrapped in a data frame. (This is a behaviour specific to Tidyverse data frames.) More on this in a moment.</p>
<p>Columns can be given by name.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>geo[<span class="dv">4</span>,<span class="st">"region"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  region
  &lt;chr&gt; 
1 asia  </code></pre>
</div>
</div>
<p>The column or row may be omitted, thereby retrieving the entire row or column.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>geo[<span class="dv">4</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 7
  name  region oecd  g77     lat  long income2017
  &lt;chr&gt; &lt;chr&gt;  &lt;lgl&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     
1 China asia   FALSE TRUE     35   105 upper_mid </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>geo[,<span class="st">"region"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 196 × 1
   region
   &lt;chr&gt; 
 1 asia  
 2 asia  
 3 asia  
 4 asia  
 5 asia  
 6 asia  
 7 asia  
 8 asia  
 9 asia  
10 asia  
# ℹ 186 more rows</code></pre>
</div>
</div>
<p>Multiple rows or columns may be retrieved using a vector.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>rows_wanted <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>geo[rows_wanted,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
  name      region oecd  g77     lat  long income2017
  &lt;chr&gt;     &lt;chr&gt;  &lt;lgl&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     
1 Australia asia   TRUE  FALSE   -25   135 high      
2 Cambodia  asia   FALSE TRUE     13   105 lower_mid 
3 Fiji      asia   FALSE TRUE    -18   178 upper_mid </code></pre>
</div>
</div>
<p>Vector indexing can also be written on a single line.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>geo[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
  name      region oecd  g77     lat  long income2017
  &lt;chr&gt;     &lt;chr&gt;  &lt;lgl&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     
1 Australia asia   TRUE  FALSE   -25   135 high      
2 Cambodia  asia   FALSE TRUE     13   105 lower_mid 
3 Fiji      asia   FALSE TRUE    -18   178 upper_mid </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>geo[<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 7
  name             region oecd  g77     lat  long income2017
  &lt;chr&gt;            &lt;chr&gt;  &lt;lgl&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     
1 Australia        asia   TRUE  FALSE -25    135  high      
2 Brunei           asia   FALSE TRUE    4.5  115. high      
3 Cambodia         asia   FALSE TRUE   13    105  lower_mid 
4 China            asia   FALSE TRUE   35    105  upper_mid 
5 Fiji             asia   FALSE TRUE  -18    178  upper_mid 
6 Hong Kong, China asia   FALSE FALSE  22.3  114. high      
7 Indonesia        asia   FALSE TRUE   -5    120  lower_mid </code></pre>
</div>
</div>
</section>
<section id="columns-are-vectors" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="columns-are-vectors"><span class="header-section-number">2.5</span> Columns are vectors</h2>
<p>Ok, so how do we actually get data out of a data frame?</p>
<p>Under the hood, a data frame is a list of column vectors. We can use <code>$</code> to retrieve columns. Occasionally it is also useful to use <code>[[ ]]</code> to retrieve columns, for example if the column name we want is stored in a variable.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( geo<span class="sc">$</span>region )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "asia" "asia" "asia" "asia" "asia" "asia"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( geo[[<span class="st">"region"</span>]] )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "asia" "asia" "asia" "asia" "asia" "asia"</code></pre>
</div>
</div>
<p>To get the “region” value of the 4th row as above, but unwrapped, we can use:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>geo<span class="sc">$</span>region[<span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "asia"</code></pre>
</div>
</div>
<p>For example, to plot the longitudes and latitudes we could use:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(geo<span class="sc">$</span>long, geo<span class="sc">$</span>lat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_frames_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<section id="quiz-reading-r-code" class="level3 unnumbered challenge">
<h3 class="unnumbered anchored" data-anchor-id="quiz-reading-r-code">Quiz: reading R code</h3>
<p>You encounter some wild R code, and aren’t sure what it does. Based on R syntax you’ve encountered so far, what roles are the different names in this code playing?</p>
<pre><code>highest &lt;- geo$name[ head(order(geo$lat, decreasing=TRUE), n=10) ]</code></pre>
<p>Find all examples of:</p>
<p>A. The name of a variable to store a value to.<br>
B. The name of a variable to retrieve the value from.<br>
C. The name of a column to get from a data frame.<br>
D. The name of a function to call.<br>
E. The name of an argument to a function call.<br>
</p>
<p>See <a href="answers/answers-reading-r-code.html">here</a> for answers.</p>
</section>
</section>
<section id="logical-indexing" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="logical-indexing"><span class="header-section-number">2.6</span> Logical indexing</h2>
<p>A method of indexing that we haven’t discussed yet is logical indexing. Instead of specifying the row number or numbers that we want, we can give a logical vector which is <code>TRUE</code> for the rows we want and <code>FALSE</code> otherwise. This can also be used with vectors.</p>
<p>We will first do this in a slightly verbose way in order to understand it, then learn a more concise way to do this using the <code>dplyr</code> package.</p>
<p>Southern countries have latitude less than zero.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>is_southern <span class="ot">&lt;-</span> geo<span class="sc">$</span>lat <span class="sc">&lt;</span> <span class="dv">0</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(is_southern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE FALSE FALSE FALSE  TRUE FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(is_southern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40</code></pre>
</div>
</div>
<p><code>sum</code> treats TRUE as 1 and FALSE as 0, so it tells us the number of TRUE elements in the vector.</p>
<p>We can use this logical vector to get the southern countries from <code>geo</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>geo[is_southern,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40 × 7
   name             region oecd  g77       lat  long income2017
   &lt;chr&gt;            &lt;chr&gt;  &lt;lgl&gt; &lt;lgl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     
 1 Australia        asia   TRUE  FALSE -25      135  high      
 2 Fiji             asia   FALSE TRUE  -18      178  upper_mid 
 3 Indonesia        asia   FALSE TRUE   -5      120  lower_mid 
 4 Nauru            asia   FALSE FALSE  -0.517  167. upper_mid 
 5 New Zealand      asia   TRUE  FALSE -42      174  high      
 6 Papua New Guinea asia   FALSE TRUE   -6      147  lower_mid 
 7 Samoa            asia   FALSE TRUE  -13.8   -172. upper_mid 
 8 Solomon Islands  asia   FALSE TRUE   -8      159  lower_mid 
 9 Timor-Leste      asia   FALSE TRUE   -8.83   126. lower_mid 
10 Tonga            asia   FALSE TRUE  -20     -175  upper_mid 
# ℹ 30 more rows</code></pre>
</div>
</div>
<p>Comparison operators available are:</p>
<ul>
<li><code>x == y</code> – “equal to”</li>
<li><code>x != y</code> – “not equal to”</li>
<li><code>x &lt; y</code> – “less than”</li>
<li><code>x &gt; y</code> – “greater than”</li>
<li><code>x &lt;= y</code> – “less than or equal to”</li>
<li><code>x &gt;= y</code> – “greater than or equal to”</li>
</ul>
<p>More complicated conditions can be constructed using logical operators:</p>
<ul>
<li><code>a &amp; b</code> – “and”, TRUE only if both <code>a</code> and <code>b</code> are TRUE.</li>
<li><code>a | b</code> – “or”, TRUE if either <code>a</code> or <code>b</code> or both are TRUE.</li>
<li><code>! a</code> – “not” , TRUE if <code>a</code> is FALSE, and FALSE if <code>a</code> is TRUE.</li>
</ul>
<p>The <code>oecd</code> column of <code>geo</code> tells which countries are in the Organisation for Economic Co-operation and Development, and the <code>g77</code> column tells which countries are in the Group of 77 (an alliance of developing nations). We could see which OECD countries are in the southern hemisphere with:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>southern_oecd <span class="ot">&lt;-</span> is_southern <span class="sc">&amp;</span> geo<span class="sc">$</span>oecd</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>geo[southern_oecd,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
  name        region   oecd  g77     lat  long income2017
  &lt;chr&gt;       &lt;chr&gt;    &lt;lgl&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     
1 Australia   asia     TRUE  FALSE -25   135   high      
2 New Zealand asia     TRUE  FALSE -42   174   high      
3 Chile       americas TRUE  TRUE  -33.5 -70.6 high      </code></pre>
</div>
</div>
<p><code>is_southern</code> seems like it should be kept within our <code>geo</code> data frame for future use. We can add it as a new column of the data frame with:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>geo<span class="sc">$</span>southern <span class="ot">&lt;-</span> is_southern</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>geo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 196 × 8
   name             region oecd  g77      lat  long income2017 southern
   &lt;chr&gt;            &lt;chr&gt;  &lt;lgl&gt; &lt;lgl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;lgl&gt;   
 1 Australia        asia   TRUE  FALSE -25     135  high       TRUE    
 2 Brunei           asia   FALSE TRUE    4.5   115. high       FALSE   
 3 Cambodia         asia   FALSE TRUE   13     105  lower_mid  FALSE   
 4 China            asia   FALSE TRUE   35     105  upper_mid  FALSE   
 5 Fiji             asia   FALSE TRUE  -18     178  upper_mid  TRUE    
 6 Hong Kong, China asia   FALSE FALSE  22.3   114. high       FALSE   
 7 Indonesia        asia   FALSE TRUE   -5     120  lower_mid  TRUE    
 8 Japan            asia   TRUE  FALSE  35.7   140. high       FALSE   
 9 Kiribati         asia   FALSE FALSE   1.42  173. lower_mid  FALSE   
10 North Korea      asia   FALSE TRUE   40     127  low        FALSE   
# ℹ 186 more rows</code></pre>
</div>
</div>
<section id="challenge-logical-indexing" class="level3 unnumbered challenge">
<h3 class="unnumbered anchored" data-anchor-id="challenge-logical-indexing">Challenge: logical indexing</h3>
<ol type="1">
<li><p>Which country is in both the OECD and the G77?</p></li>
<li><p>Which countries are in neither the OECD nor the G77?</p></li>
<li><p>Which countries are in the Americas? These have longitudes between -150 and -40.</p></li>
</ol>
</section>
<section id="a-dplyr-shorthand" class="level3" data-number="2.6.1">
<h3 data-number="2.6.1" class="anchored" data-anchor-id="a-dplyr-shorthand"><span class="header-section-number">2.6.1</span> A <code>dplyr</code> shorthand</h3>
<p>The above method is a little laborious. We have to keep mentioning the name of the data frame, and there is a lot of punctuation to keep track of. <code>dplyr</code> provides a slightly magical function called <code>filter</code> which lets us write more concisely. For example:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(geo, lat <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> oecd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 8
  name        region   oecd  g77     lat  long income2017 southern
  &lt;chr&gt;       &lt;chr&gt;    &lt;lgl&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;lgl&gt;   
1 Australia   asia     TRUE  FALSE -25   135   high       TRUE    
2 New Zealand asia     TRUE  FALSE -42   174   high       TRUE    
3 Chile       americas TRUE  TRUE  -33.5 -70.6 high       TRUE    </code></pre>
</div>
</div>
<p>In the second argument, we are able to refer to columns of the data frame as though they were variables. The code is beautiful, but also opaque. It’s important to understand that under the hood we are creating and combining logical vectors.</p>
</section>
</section>
<section id="factors" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="factors"><span class="header-section-number">2.7</span> Factors</h2>
<p>The <code>count</code> function from <code>dplyr</code> can help us understand the contents of some of the columns in <code>geo</code>. <code>count</code> is also <em>magical</em>, we can refer to columns of the data frame directly in the arguments to <code>count</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(geo, region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  region       n
  &lt;chr&gt;    &lt;int&gt;
1 africa      54
2 americas    35
3 asia        59
4 europe      48</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(geo, income2017)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  income2017     n
  &lt;chr&gt;      &lt;int&gt;
1 high          58
2 low           31
3 lower_mid     52
4 upper_mid     55</code></pre>
</div>
</div>
<p>One annoyance here is that the different categories in <code>income2017</code> aren’t in a sensible order. This comes up quite often, for example when sorting or plotting categorical data. R’s solution is a further type of vector called a <em>factor</em> (think a factor of an experimental design). A factor holds categorical data, and has an associated ordered set of <em>levels</em>. It is otherwise quite similar to a character vector.</p>
<p>Any sort of vector can be converted to a factor using the <code>factor</code> function. This function defaults to placing the levels in alphabetical order, but takes a <code>levels</code> argument that can override this.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( <span class="fu">factor</span>(geo<span class="sc">$</span>income2017, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"low"</span>,<span class="st">"lower_mid"</span>,<span class="st">"upper_mid"</span>,<span class="st">"high"</span>)) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] high      high      lower_mid upper_mid upper_mid high     
Levels: low lower_mid upper_mid high</code></pre>
</div>
</div>
<p>We should modify the <code>income2017</code> column of the <code>geo</code> table in order to use this:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>geo<span class="sc">$</span>income2017 <span class="ot">&lt;-</span> <span class="fu">factor</span>(geo<span class="sc">$</span>income2017, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"low"</span>,<span class="st">"lower_mid"</span>,<span class="st">"upper_mid"</span>,<span class="st">"high"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>count</code> now produces the desired order of output:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(geo, income2017)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  income2017     n
  &lt;fct&gt;      &lt;int&gt;
1 low           31
2 lower_mid     52
3 upper_mid     55
4 high          58</code></pre>
</div>
</div>
<p>When <code>plot</code> is given a factor, it shows a bar plot:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(geo<span class="sc">$</span>income2017)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_frames_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>When given two factors, it shows a mosaic plot:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(geo<span class="sc">$</span>income2017, <span class="fu">factor</span>(geo<span class="sc">$</span>oecd))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data_frames_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Similarly we can count two categorical columns at once.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(geo, income2017, oecd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  income2017 oecd      n
  &lt;fct&gt;      &lt;lgl&gt; &lt;int&gt;
1 low        FALSE    31
2 lower_mid  FALSE    52
3 upper_mid  FALSE    53
4 upper_mid  TRUE      2
5 high       FALSE    29
6 high       TRUE     29</code></pre>
</div>
</div>
</section>
<section id="readability-vs-tidyness" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="readability-vs-tidyness"><span class="header-section-number">2.8</span> Readability vs tidyness</h2>
<p>The counts we obtained counting <code>income2017</code> vs <code>oecd</code> were properly tidy in the sense of containing a single unit of observation per row. However to view the data, it would be more convenient to have income as columns and OECD membership as rows. We can use the <code>pivot_wider</code> function from <code>tidyr</code> to achieve this. (This is also sometimes also called a “cast” or a “spread”.)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> <span class="fu">count</span>(geo, income2017, oecd)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span>(counts, <span class="at">names_from=</span>income2017, <span class="at">values_from=</span>n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  oecd    low lower_mid upper_mid  high
  &lt;lgl&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt; &lt;int&gt;
1 FALSE    31        52        53    29
2 TRUE     NA        NA         2    29</code></pre>
</div>
</div>
<p>We could further specify <code>values_fill=list(n=0)</code> to fill in the <code>NA</code> values with 0. Or when using <code>count</code>, make sure all the relevant columns are factors and specify <code>.drop=FALSE</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Tidying is often the first step when exploring a data-set. The <a href="http://tidyr.tidyverse.org/">tidyr</a> package contains a number of useful functions that help tidy (or un-tidy!) data. We’ve just seen <code>pivot_wider</code> which spreads two columns into multiple columns. The inverse of <code>pivot_wider</code> is <code>pivot_longer</code>, which gathers multiple columns into two columns: a column of column names, and a column of values. <code>pivot_longer</code> is often the first step when tidying a dataset you have received from the wild. (This is sometimes also called a “melt” or a “gather”.)</p>
<p><a href="https://www.garrickadenbuie.com/project/tidyexplain/#pivot-wider-and-longer">Here’s an animation illustrating these functions.</a></p>
</div>
</div>
<!--
:::{.challenge}
### Challenge: counting {-}

Investigate how many OECD and non-OECD nations come from the northern and southern hemispheres.

1. Using `count`.
2. By making a mosaic plot.

Remember you may need to convert columns to factors for `plot` to work, and that a `southern` column could be added to `geo` with:






::: {.cell layout-align="center"}

```{.r .cell-code}
geo$southern <- geo$lat < 0
```
:::





:::
-->
</section>
<section id="sorting" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="sorting"><span class="header-section-number">2.9</span> Sorting</h2>
<p>Data frames can be sorted using the <code>arrange</code> function in <code>dplyr</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(geo, lat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 196 × 8
   name         region   oecd  g77     lat  long income2017 southern
   &lt;chr&gt;        &lt;chr&gt;    &lt;lgl&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;lgl&gt;   
 1 New Zealand  asia     TRUE  FALSE -42   174   high       TRUE    
 2 Argentina    americas FALSE TRUE  -34   -64   upper_mid  TRUE    
 3 Chile        americas TRUE  TRUE  -33.5 -70.6 high       TRUE    
 4 Uruguay      americas FALSE TRUE  -33   -56   high       TRUE    
 5 Lesotho      africa   FALSE TRUE  -29.5  28.2 lower_mid  TRUE    
 6 South Africa africa   FALSE TRUE  -29    24   upper_mid  TRUE    
 7 Swaziland    africa   FALSE TRUE  -26.5  31.5 lower_mid  TRUE    
 8 Australia    asia     TRUE  FALSE -25   135   high       TRUE    
 9 Paraguay     americas FALSE TRUE  -23.3 -58   upper_mid  TRUE    
10 Botswana     africa   FALSE TRUE  -22    24   upper_mid  TRUE    
# ℹ 186 more rows</code></pre>
</div>
</div>
<p>Numeric columns are sorted in numeric order. Character columns will be sorted in alphabetical order. Factor columns are sorted in order of their levels. The <code>desc</code> helper function can be used to sort in descending order.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(geo, <span class="fu">desc</span>(name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 196 × 8
   name           region   oecd  g77     lat   long income2017 southern
   &lt;chr&gt;          &lt;chr&gt;    &lt;lgl&gt; &lt;lgl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;      &lt;lgl&gt;   
 1 Zimbabwe       africa   FALSE TRUE  -19    29.8  low        TRUE    
 2 Zambia         africa   FALSE TRUE  -14.3  28.5  lower_mid  TRUE    
 3 Yemen          asia     FALSE TRUE   15.5  47.5  lower_mid  FALSE   
 4 Vietnam        asia     FALSE TRUE   16.2 108.   lower_mid  FALSE   
 5 Venezuela      americas FALSE TRUE    8   -66    upper_mid  FALSE   
 6 Vanuatu        asia     FALSE TRUE  -16   167    lower_mid  TRUE    
 7 Uzbekistan     asia     FALSE FALSE  41.7  63.8  lower_mid  FALSE   
 8 Uruguay        americas FALSE TRUE  -33   -56    high       TRUE    
 9 United States  americas TRUE  FALSE  39.8 -98.5  high       FALSE   
10 United Kingdom europe   TRUE  FALSE  54.8  -2.70 high       FALSE   
# ℹ 186 more rows</code></pre>
</div>
</div>
</section>
<section id="joining-data-frames" class="level2" data-number="2.10">
<h2 data-number="2.10" class="anchored" data-anchor-id="joining-data-frames"><span class="header-section-number">2.10</span> Joining data frames</h2>
<p>Let’s move on to a larger data set. This is from the <a href="https://www.gapminder.org">Gapminder</a> project and contains information about countries over time.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>gap <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"r-intro/gap-minder.csv"</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>gap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,312 × 5
   name                 year population gdp_percap life_exp
   &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
 1 Afghanistan          1800    3280000        603     28.2
 2 Albania              1800     410445        667     35.4
 3 Algeria              1800    2503218        715     28.8
 4 Andorra              1800       2654       1197     NA  
 5 Angola               1800    1567028        618     27.0
 6 Antigua and Barbuda  1800      37000        757     33.5
 7 Argentina            1800     534000       1507     33.2
 8 Armenia              1800     413326        514     34  
 9 Australia            1800     351014        814     34.0
10 Austria              1800    3205587       1847     34.4
# ℹ 4,302 more rows</code></pre>
</div>
</div>
<section id="quiz" class="level3 unnumbered challenge">
<h3 class="unnumbered anchored" data-anchor-id="quiz">Quiz</h3>
<p>What does each row represent in this new data frame?</p>
</section>
<p>It would be useful to have general information about countries from <code>geo</code> available as columns when we use this data frame. <code>gap</code> and <code>geo</code> share a column called <code>name</code> which can be used to match rows from one to the other.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>gap_geo <span class="ot">&lt;-</span> <span class="fu">left_join</span>(gap, geo, <span class="at">by=</span><span class="st">"name"</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>gap_geo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,312 × 12
   name      year population gdp_percap life_exp region oecd  g77     lat   long
   &lt;chr&gt;    &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;  &lt;lgl&gt; &lt;lgl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1 Afghani…  1800    3280000        603     28.2 asia   FALSE TRUE   33    66   
 2 Albania   1800     410445        667     35.4 europe FALSE FALSE  41    20   
 3 Algeria   1800    2503218        715     28.8 africa FALSE TRUE   28     3   
 4 Andorra   1800       2654       1197     NA   europe FALSE FALSE  42.5   1.52
 5 Angola    1800    1567028        618     27.0 africa FALSE TRUE  -12.5  18.5 
 6 Antigua…  1800      37000        757     33.5 ameri… FALSE TRUE   17.0 -61.8 
 7 Argenti…  1800     534000       1507     33.2 ameri… FALSE TRUE  -34   -64   
 8 Armenia   1800     413326        514     34   europe FALSE FALSE  40.2  45   
 9 Austral…  1800     351014        814     34.0 asia   TRUE  FALSE -25   135   
10 Austria   1800    3205587       1847     34.4 europe TRUE  FALSE  47.3  13.3 
# ℹ 4,302 more rows
# ℹ 2 more variables: income2017 &lt;fct&gt;, southern &lt;lgl&gt;</code></pre>
</div>
</div>
<p>The output contains all ways of pairing up rows by <code>name</code>. In this case each row of <code>geo</code> pairs up with multiple rows of <code>gap</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The “left” in “left join” refers to how rows that can’t be paired up are handled. <code>left_join</code> keeps all rows from the first data frame but not the second. This is a good default when the intent is to attaching some extra information to a data frame. <code>inner_join</code> discards all rows that can’t be paired up. <code>full_join</code> keeps all rows from both data frames.</p>
<p><a href="https://www.garrickadenbuie.com/project/tidyexplain/#mutating-joins">Here are some animations illustrating joins.</a></p>
</div>
</div>
</section>
<section id="further-reading" class="level2" data-number="2.11">
<h2 data-number="2.11" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">2.11</span> Further reading</h2>
<p>We’ve covered the fundamentals of dplyr and data frames, but there is much more to learn. Notably, we haven’t covered the use of the pipe <code>|&gt;</code> to chain <code>dplyr</code> verbs together (and you may also come across an older version of the pipe symbol <code>%&gt;%</code>). The <a href="https://r4ds.hadley.nz/">“R for Data Science” book</a> is an excellent source to learn more. The Monash Data Fluency <a href="https://monashdatafluency.github.io/r-progtidy/">“Programming and Tidy data analysis in R” course</a> also covers this.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./starting.html" class="pagination-link" aria-label="Starting out in R">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Starting out in R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./plotting.html" class="pagination-link" aria-label="Plotting with ggplot2">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Plotting with ggplot2</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>